{% extends "base.html" %}
{% block contenido %}


    {% if request.resolver_match.url_name != 'pedidos_home' %}
    
[ğŸ  Inicio]({% url 'pedidos_home' %})
    {% endif %}
    {% if request.resolver_match.url_name != 'posibles_clientes' %}
    
[ğŸ‘¥ Posibles clientes]({% url 'posibles_clientes' %})
    {% endif %}
    {% if request.resolver_match.url_name != 'gastos' %}
    
[ğŸ’° Gastos]({% url 'gastos' %})
    {% endif %}
    {% if request.resolver_match.url_name != 'resumen' %}
    
[ğŸ“Š Resumen]({% url 'resumen' %})
    {% endif %}
    {% if request.resolver_match.url_name != 'configuracion' %}
    
[âš™ï¸ ConfiguraciÃ³n]({% url 'configuracion' %})
    {% endif %}
ğŸ“… Agenda
    â• Nueva cita
    {% if citas_hoy_count > 0 %}
        {{ citas_hoy_count }} hoy
    {% endif %}
ğŸ“ Nueva cita
        {% csrf_token %}
        
         Fecha * Hora * Cliente * TelÃ©fono * Tipo * â€” Seleccionar â€” Nuevo cliente Cliente existente Seguimiento ReuniÃ³n Club Notas ğŸ’¾ Guardar Cancelar 
{% if citas %}
ğŸ“‹ Citas ({{ citas|length }})
| Fecha
|Hora
|Cliente
|TelÃ©fono
|Club
|Tipo
|Notas
|Acciones
|
| ---|---|---|---|---|---|---|---|
            {% for c in citas %}
            
| {{ c.Fecha|default:"â€”" }}
|{{ c.Hora|default:"â€”" }}
|{{ c.Cliente|default:"â€”" }}
|{{ c.Telefono|default:"â€”" }}
|{{ c.Club|default:"â€”" }}
|{{ c.Tipo|default:"â€”" }}
|{{ c.Notas|default:"â€”" }}
|  [ğŸ—‘ï¸]({% url 'agenda_eliminar' c.ID %})  
|
| ---|---|---|---|---|---|---|---|
            {% endfor %}
        
{% else %}
ğŸ“­ No hay citas programadas
{% endif %}

<!-- ============================================ -->
<!-- ğŸ”¹ NUEVA SECCIÃ“N: TAREAS DIARIAS -->
<!-- ============================================ -->
<div style="margin-top: 40px; padding: 20px; background: #f0f8ff; border-radius: 10px; border: 2px solid #4682b4;">
    <h2 style="color: #2c3e50; margin-bottom: 20px;">âœ… Lista de Tareas</h2>
    
    <!-- Formulario para nueva tarea -->
    <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
        <h3 style="color: #3498db; margin-bottom: 15px;">â• Nueva Tarea</h3>
        <form id="formTarea" style="display: flex; flex-wrap: wrap; gap: 15px; align-items: flex-end;">
            <div style="flex: 1; min-width: 200px;">
                <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #2c3e50;">ğŸ‘¤ Cliente / Club *</label>
                <input 
                    type="text" 
                    id="tareaClienteClub" 
                    placeholder="Ej: Amigos de la tercera edad"
                    style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px;"
                    required
                >
            </div>
            
            <div style="flex: 2; min-width: 300px;">
                <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #2c3e50;">ğŸ“ DescripciÃ³n de la tarea *</label>
                <input 
                    type="text" 
                    id="tareaDescripcion" 
                    placeholder="Ej: Llamar para confirmar pedido de camisetas"
                    style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px;"
                    required
                >
            </div>
            
            <button 
                type="submit" 
                style="background: #27ae60; color: white; padding: 12px 25px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 14px; transition: all 0.3s;"
                onmouseover="this.style.background='#229954'" 
                onmouseout="this.style.background='#27ae60'"
            >
                ğŸ“¥ AÃ±adir Tarea
            </button>
        </form>
    </div>
    
    <!-- Lista de tareas -->
    <div id="listaTareasContainer">
        <h3 style="color: #2c3e50; margin-bottom: 15px;">ğŸ“‹ Tareas Pendientes (0)</h3>
        <div id="listaTareas" style="display: flex; flex-direction: column; gap: 10px;">
            <!-- Las tareas se cargarÃ¡n aquÃ­ dinÃ¡micamente -->
            <p id="mensajeVacio" style="text-align: center; color: #7f8c8d; font-style: italic;">ğŸ“­ No hay tareas pendientes</p>
        </div>
    </div>
</div>

<script>
// ============================================
// ğŸ”¹ FUNCIONALIDAD DE TAREAS
// ============================================

// Cargar tareas al iniciar
document.addEventListener('DOMContentLoaded', function() {
    cargarTareas();
    
    // Manejar formulario
    document.getElementById('formTarea').addEventListener('submit', function(e) {
        e.preventDefault();
        agregarTarea();
    });
});

// ğŸ”¹ Agregar nueva tarea
function agregarTarea() {
    const clienteClub = document.getElementById('tareaClienteClub').value.trim();
    const descripcion = document.getElementById('tareaDescripcion').value.trim();
    
    if (!clienteClub || !descripcion) {
        alert('âš ï¸ Por favor, completa ambos campos');
        return;
    }
    
    // Crear objeto tarea
    const tarea = {
        id: 'tarea_' + Date.now(),
        clienteClub: clienteClub,
        descripcion: descripcion,
        completada: false,
        fechaCreacion: new Date().toISOString()
    };
    
    // Guardar en localStorage (simulaciÃ³n hasta que se integre con Firebase)
    let tareas = JSON.parse(localStorage.getItem('tareasDiarias') || '[]');
    tareas.push(tarea);
    localStorage.setItem('tareasDiarias', JSON.stringify(tareas));
    
    // Limpiar formulario
    document.getElementById('tareaClienteClub').value = '';
    document.getElementById('tareaDescripcion').value = '';
    
    // Recargar lista
    cargarTareas();
    
    alert('âœ… Tarea aÃ±adida correctamente');
}

// ğŸ”¹ Cargar tareas
function cargarTareas() {
    const tareas = JSON.parse(localStorage.getItem('tareasDiarias') || '[]');
    const lista = document.getElementById('listaTareas');
    const mensajeVacio = document.getElementById('mensajeVacio');
    const contador = document.querySelector('#listaTareasContainer h3');
    
    // Filtrar tareas pendientes
    const tareasPendientes = tareas.filter(t => !t.completada);
    
    // Actualizar contador
    contador.textContent = `ğŸ“‹ Tareas Pendientes (${tareasPendientes.length})`;
    
    // Limpiar lista
    lista.innerHTML = '';
    
    if (tareasPendientes.length === 0) {
        lista.appendChild(mensajeVacio);
        return;
    }
    
    // Mostrar tareas
    tareasPendientes.forEach(tarea => {
        const tareaDiv = document.createElement('div');
        tareaDiv.style.cssText = `
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid #3498db;
        `;
        
        tareaDiv.innerHTML = `
            <div style="flex: 1;">
                <strong style="color: #2c3e50; font-size: 16px;">${tarea.clienteClub}</strong>
                <br>
                <span style="color: #7f8c8d;">${tarea.descripcion}</span>
                <br>
                <small style="color: #95a5a6; font-size: 12px;">
                    ğŸ“… ${new Date(tarea.fechaCreacion).toLocaleDateString('es-ES')}
                </small>
            </div>
            <div style="display: flex; gap: 10px;">
                <button 
                    onclick="completarTarea('${tarea.id}')" 
                    style="background: #27ae60; color: white; padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;"
                    title="Marcar como completada"
                >
                    âœ…
                </button>
                <button 
                    onclick="eliminarTarea('${tarea.id}')" 
                    style="background: #e74c3c; color: white; padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;"
                    title="Eliminar tarea"
                >
                    ğŸ—‘ï¸
                </button>
            </div>
        `;
        
        lista.appendChild(tareaDiv);
    });
}

// ğŸ”¹ Completar tarea
function completarTarea(id) {
    if (!confirm('Â¿Marcar esta tarea como completada?')) return;
    
    let tareas = JSON.parse(localStorage.getItem('tareasDiarias') || '[]');
    const tarea = tareas.find(t => t.id === id);
    
    if (tarea) {
        tarea.completada = true;
        tarea.fechaCompletada = new Date().toISOString();
        localStorage.setItem('tareasDiarias', JSON.stringify(tareas));
        cargarTareas();
        alert('âœ… Tarea completada');
    }
}

// ğŸ”¹ Eliminar tarea
function eliminarTarea(id) {
    if (!confirm('Â¿Eliminar esta tarea?')) return;
    
    let tareas = JSON.parse(localStorage.getItem('tareasDiarias') || '[]');
    tareas = tareas.filter(t => t.id !== id);
    localStorage.setItem('tareasDiarias', JSON.stringify(tareas));
    cargarTareas();
    alert('ğŸ—‘ï¸ Tarea eliminada');
}
</script>

[â¬…ï¸ Volver a Inicio]({% url 'pedidos_home' %})
{% endblock %}