{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <h2>Editar Pedido</h2>

    <form method="post">
        {% csrf_token %}

        <!-- NOMBRE CLIENTE -->
        <div class="form-group">
            <label for="nombre_cliente">Nombre Cliente:</label>
            <input type="text" class="form-control" name="nombre_cliente" value="{{ pedido.nombre_cliente }}" required>
        </div>

        <!-- TELEFONO -->
        <div class="form-group">
            <label for="telefono">Teléfono:</label>
            <input type="text" class="form-control" name="telefono" value="{{ pedido.telefono }}">
        </div>

        <!-- DESCRIPCIÓN -->
        <div class="form-group">
            <label for="descripcion">Descripción:</label>
            <textarea class="form-control" name="descripcion" rows="4">{{ pedido.descripcion }}</textarea>
        </div>

        <!-- FECHA DE ENTRADA -->
        <div class="form-group">
            <label for="Fecha_entrada">Fecha de entrada:</label>
            <input type="date" class="form-control" name="Fecha_entrada" value="{{ pedido.Fecha_entrada }}">
        </div>

        <hr>

        <!-- ESTADOS -->
        <h4>Estados</h4>

        <div class="form-check">
            <input class="form-check-input" type="checkbox" name="trabajo_terminado"
                   {% if pedido.trabajo_terminado %}checked{% endif %}>
            <label class="form-check-label">Trabajo terminado</label>
        </div>

        <div class="form-check">
            <input class="form-check-input" type="checkbox" name="retirado"
                   {% if pedido.retirado %}checked{% endif %}>
            <label class="form-check-label">Retirado</label>
        </div>

        <div class="form-check">
            <input class="form-check-input" type="checkbox" name="cobrado"
                   {% if pedido.cobrado %}checked{% endif %}>
            <label class="form-check-label">Cobrado</label>
        </div>

        <hr>

        <!-- FECHA FINALIZACIÓN (MOSTRAR SOLO SI EXISTE O SI LOS 3 ESTADOS ESTÁN MARCADOS) -->
        {% if pedido.trabajo_terminado and pedido.retirado and pedido.cobrado %}
        <div class="form-group mt-3">
            <label for="Fecha_finalizacion">Fecha de finalización:</label>

            <input type="date"
                   class="form-control"
                   name="Fecha_finalizacion"
                   value="{{ pedido.Fecha_finalizacion|date:'Y-m-d' }}"
                   readonly>
        </div>
        {% endif %}

        <button type="submit" class="btn btn-primary mt-4">Guardar Cambios</button>
        <a href="{% url 'pedidos_lista' %}" class="btn btn-secondary mt-4">Cancelar</a>

    </form>
</div>

<script>
    // MOSTRAR CAMPO FECHA FINALIZACIÓN DINÁMICAMENTE EN EL FRONTEND TAMBIÉN
    document.addEventListener("DOMContentLoaded", () => {

        const terminado = document.querySelector("input[name='trabajo_terminado']");
        const retirado = document.querySelector("input[name='retirado']");
        const cobrado = document.querySelector("input[name='cobrado']");

        function toggleFecha() {
            const field = document.getElementById("fecha-finalizacion-block");
            if (field) {
                field.style.display =
                    (terminado.checked && retirado.checked && cobrado.checked)
                        ? "block"
                        : "none";
            }
        }

        terminado.addEventListener("change", toggleFecha);
        retirado.addEventListener("change", toggleFecha);
        cobrado.addEventListener("change", toggleFecha);

        toggleFecha();
    });
</script>

{% endblock %}
