{% extends "base.html" %}
{% block contenido %}

<!-- MenÃº de navegaciÃ³n -->
<nav class="navbar-nav-horizontal mb-4">
    {% if request.resolver_match.url_name != 'agenda' %}
    <a href="{% url 'agenda' %}" class="nav-item {% if request.resolver_match.url_name == 'agenda' %}active{% endif %}">ğŸ“… Agenda</a>
    {% endif %}

{% if request.resolver_match.url_name != 'tareas' %}
    <a href="{% url 'tareas' %}" class="nav-item {% if request.resolver_match.url_name == 'tareas' %}active{% endif %}">âœ… Tareas</a>
    {% endif %}

    {% if request.resolver_match.url_name != 'posibles_clientes' %}
    <a href="{% url 'posibles_clientes' %}" class="nav-item {% if request.resolver_match.url_name == 'posibles_clientes' %}active{% endif %}">ğŸ‘¥ Posibles clientes</a>
    {% endif %}
    {% if request.resolver_match.url_name != 'gastos' %}
    <a href="{% url 'gastos' %}" class="nav-item {% if request.resolver_match.url_name == 'gastos' %}active{% endif %}">ğŸ’° Gastos</a>
    {% endif %}
    {% if request.resolver_match.url_name != 'resumen' %}
    <a href="{% url 'resumen' %}" class="nav-item {% if request.resolver_match.url_name == 'resumen' %}active{% endif %}">ğŸ“Š Resumen</a>
    {% endif %}
    {% if request.resolver_match.url_name != 'configuracion' %}
    <a href="{% url 'configuracion' %}" class="nav-item {% if request.resolver_match.url_name == 'configuracion' %}active{% endif %}">âš™ï¸ ConfiguraciÃ³n</a>
    {% endif %}
</nav>

<h2>ğŸ“‹ Pedidos ({{ pedidos|length }})</h2>

<a href="{% url 'pedido_crear' %}" class="btn btn-primary mb-4">â• Nuevo pedido</a>

{% if pedidos %}
<table class="table-home table table-striped">
    <thead>
        <tr>
            <th>ID</th>
            <th>Club</th>
            <th>Cliente</th>
            <th>TelÃ©fono</th>
            <th>Productos</th>
            <th>Precio</th>
            <th>Precio factura</th>
            <th>Entrada</th>
            <th>Estimada</th>
            <th>Salida</th>
            <th>Estado</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        {% for p in pedidos %}
        {# â­ NUEVA LÃ“GICA DE COLORES POR ESTADO â­ #}
        {% if "fabricacion" in p.Estados %}
            <tr class="fila-fabricacion">
        {% elif "trabajo iniciado" in p.Estados %}
            <tr class="fila-trabajo-iniciado">
        {% elif "pendiente" in p.Estados %}
            <tr class="fila-pendiente">
        {% elif "trabajo terminado" in p.Estados and "retirado" in p.Estados and "cobrado" in p.Estados %}
            <tr class="fila-finalizado">
        {% elif "trabajo terminado" in p.Estados %}
            <tr class="fila-terminado-no-cobrado">
        {% else %}
            <tr>
        {% endif %}
        {# â­ FIN LÃ“GICA DE COLORES â­ #}
            <td>{{ p.ID }}</td>
            <td>{{ p.Club }}</td>
            <td>{{ p.Cliente }}</td>
            <td>{{ p.Telefono }}</td>
            <td>
                {% if p.productos %}
                    {{ p.productos|length }} productos
                {% else %}
                    â€”
                {% endif %}
            </td>
            <td>{{ p.Precio|default:"â€”" }}</td>
            <td>{{ p.Precio_factura|default:"â€”" }}</td>
            <td>{{ p.Fecha_entrada|default:"â€”" }}</td>
            <td>{{ p.Fecha_entrega_estimada|default:"â€”" }}</td>
            <td>{{ p.Fecha_finalizacion|default:"â€”" }}</td>
            <td>{{ p.Estados_iconos|safe }}</td>
            <td>
                <a href="{% url 'pedido_detalle' p.ID %}" class="btn btn-sm btn-info btn-ver">Ver</a>
                <a href="{% url 'pedido_editar' p.ID %}" class="btn btn-sm btn-warning btn-desktop">Editar</a>
                <a href="{% url 'pedido_eliminar' p.ID %}" class="btn btn-sm btn-danger btn-desktop">Eliminar</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<div class="card-custom">
    <p>No hay pedidos.</p>
</div>
{% endif %}

{% endblock %}