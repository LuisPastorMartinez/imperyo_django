{% extends "base.html" %}
{% block contenido %}

<div class="card-custom p-4">

    <!-- Men√∫ de navegaci√≥n -->
    <nav class="navbar-nav-horizontal mb-4">
        <a href="{% url 'pedidos_home' %}" class="nav-item {% if request.resolver_match.url_name == 'pedidos_home' %}active{% endif %}">Inicio</a>
        <a href="{% url 'posibles_clientes' %}" class="nav-item {% if request.resolver_match.url_name == 'posibles_clientes' %}active{% endif %}">Posibles clientes</a>
        <a href="{% url 'gastos' %}" class="nav-item {% if request.resolver_match.url_name == 'gastos' %}active{% endif %}">Gastos</a>
        <a href="{% url 'resumen' %}" class="nav-item {% if request.resolver_match.url_name == 'resumen' %}active{% endif %}">Resumen</a>
        <a href="{% url 'configuracion' %}" class="nav-item {% if request.resolver_match.url_name == 'configuracion' %}active{% endif %}">Configuraci√≥n</a>
    </nav>

    <h2 class="mb-4">üìã Pedidos ({{ pedidos|length }})</h2>

    <a href="{% url 'pedido_crear' %}" class="btn btn-primary mb-4">
        ‚ûï Nuevo pedido
    </a>

    {% if pedidos %}
    <div class="table-responsive">
        <table class="table-home table table-bordered table-hover align-middle">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Club</th>
                    <th>Cliente</th>
                    <th>Tel√©fono</th>
                    <th>Productos</th>
                    <th>Precio</th>
                    <th>Precio factura</th>
                    <th>Entrada</th>
                    <th>Estimada</th>
                    <th>Salida</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
            </thead>

            <tbody>
                {% for p in pedidos %}

                {#  ‚≠ê NUEVA L√ìGICA DE COLORES POR ESTADO ‚≠ê #}
                {% if "fabricacion" in p.Estados %}
                    <tr class="fila-fabricacion">

                {% elif "pendiente" in p.Estados %}
                    <tr class="fila-pendiente">

                {% elif "trabajo terminado" in p.Estados and "retirado" in p.Estados and "cobrado" in p.Estados %}
                    <tr class="fila-finalizado">

                {% elif "trabajo terminado" in p.Estados %}
                    <tr class="fila-terminado-no-cobrado">

                {% else %}
                    <tr>
                {% endif %}
                {#  ‚≠ê FIN L√ìGICA DE COLORES ‚≠ê #}

                    <td><strong>{{ p.ID }}</strong></td>
                    <td>{{ p.Club }}</td>
                    <td>{{ p.Cliente }}</td>
                    <td>{{ p.Telefono }}</td>

                    <td>
                        {% if p.productos %}
                            {{ p.productos|length }} productos
                        {% else %}
                            ‚Äî
                        {% endif %}
                    </td>

                    <td>{{ p.Precio|default:"‚Äî" }}</td>
                    <td>{{ p.Precio_factura|default:"‚Äî" }}</td>
                    <td>{{ p.Fecha_entrada|default:"‚Äî" }}</td>
                    <td>{{ p.Fecha_entrega_estimada|default:"‚Äî" }}</td>
                    <td>{{ p.Fecha_finalizacion|default:"‚Äî" }}</td>

                    <td class="estado-iconos">
                        {{ p.Estados_iconos|safe }}
                    </td>
<td class="acciones">

    <!-- ‚úî SIEMPRE visible -->
    <a href="{% url 'pedido_detalle' p.ID %}"
       class="btn btn-info btn-sm btn-ver">
       Ver
    </a>

    <!-- ‚ùå OCULTAR EN M√ìVIL -->
    <a href="{% url 'pedido_editar' p.ID %}"
       class="btn btn-warning btn-sm btn-desktop">
       Editar
    </a>

    <a href="{% url 'pedido_eliminar' p.ID %}"
       class="btn btn-danger btn-sm btn-desktop">
       Eliminar
    </a>

</td>

                    

                </tr>

                {% endfor %}
            </tbody>
        </table>
    </div>

    {% else %}
    <div class="alert alert-secondary">
        No hay pedidos.
    </div>
    {% endif %}

</div>

{% endblock %}
