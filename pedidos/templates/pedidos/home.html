{% extends "base.html" %}
{% block contenido %}

<!-- Men√∫ de navegaci√≥n -->
<nav class="navbar-nav-horizontal mb-4">
    {% if request.resolver_match.url_name != 'agenda' %}
    <a href="{% url 'agenda' %}" class="nav-item {% if request.resolver_match.url_name == 'agenda' %}active{% endif %}">
        üìÖ Agenda
        {% if citas_hoy_count_global > 0 %}
            <span class="badge bg-danger">{{ citas_hoy_count_global }}</span>
        {% endif %}
    </a>
    {% endif %}
‚Ä¶    <a href="{% url 'configuracion' %}" class="nav-item {% if request.resolver_match.url_name == 'configuracion' %}active{% endif %}">‚öôÔ∏è Configuraci√≥n</a>
    {% endif %}
</nav>

<h2>üìã Pedidos ({{ pedidos|length }})</h2>

<a href="{% url 'pedido_crear' %}" class="btn btn-primary mb-4">‚ûï Nuevo pedido</a>

{% if pedidos %}
<table class="table-home table table-striped">
    <thead>
        <tr>
            <th>ID</th>
            <th>Club</th>
            <th>Cliente</th>
            <th>Tel√©fono</th>
            <th>Productos</th>
            <th>Precio</th>
            <th>Precio factura</th>
            <th>Entrada</th>
            <th>Estimada</th>
            <th>Salida</th>
            <th>Estado</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        {% for p in pedidos %}
        {# ‚≠ê NUEVA L√ìGICA DE COLORES POR ESTADO ‚≠ê #}
        {% if "fabricacion" in p.Estados %}
            <tr class="fila-fabricacion">
        {% elif "trabajo iniciado" in p.Estados %}
            <tr class="fila-trabajo-iniciado">
        {% elif "pendiente" in p.Estados %}
            <tr class="fila-pendiente">
        {% elif "trabajo terminado" in p.Estados and "retirado" in p.Estados and "cobrado" in p.Estados %}
            <tr class="fila-finalizado">
        {% elif "trabajo terminado" in p.Estados %}
            <tr class="fila-terminado-no-cobrado">
        {% else %}
            <tr>
        {% endif %}
        {# ‚≠ê FIN L√ìGICA DE COLORES ‚≠ê #}
            <td>{{ p.ID }}</td>
            <td>{{ p.Club }}</td>
            <td>{{ p.Cliente }}</td>
            <td>{{ p.Telefono }}</td>
            <td>
                {% if p.productos %}
                    {{ p.productos|length }} productos
                {% else %}
                    ‚Äî
                {% endif %}
            </td>
            <td>{{ p.Precio|default:"‚Äî" }}</td>
            <td>{{ p.Precio_factura|default:"‚Äî" }}</td>
            <td>{{ p.Fecha_entrada|default:"‚Äî" }}</td>
            <td>{{ p.Fecha_entrega_estimada|default:"‚Äî" }}</td>
            <td>{{ p.Fecha_finalizacion|default:"‚Äî" }}</td>
            <td>{{ p.Estados_iconos|safe }}</td>
            <td>
                <a href="{% url 'pedido_detalle' p.ID %}" class="btn btn-sm btn-info btn-ver">Ver</a>
                <a href="{% url 'pedido_editar' p.ID %}" class="btn btn-sm btn-warning btn-desktop">Editar</a>
                <a href="{% url 'pedido_eliminar' p.ID %}" class="btn btn-sm btn-danger btn-desktop">Eliminar</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<div class="card-custom">
    <p>No hay pedidos.</p>
</div>
{% endif %}

{% endblock %}